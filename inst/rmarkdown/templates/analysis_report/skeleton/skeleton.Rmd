---
title: "t101XX Telethon Kids Institute Report Template"
subtitle: "Biometrics Analysis Report"
author:
  - "Author&nbsp;1<sup>1</sup> and Author&nbsp;2<sup>2</sup>"
affiliation:
  - "<sup>1</sup>Telethon Kids Institute, Biometrics Group"
  - "<sup>2</sup>Other Affiliation(s)"
date: "`r format(Sys.time(), '%d %B %Y')`"
logo: assets/images/logo800.jpg
nav_logo: assets/images/logo_plain.jpg
header-background: green-circles-darker
header-breakout: pms2395-breakout
output:
  html_document:
    toc: true
    toc_float: true
    template: assets/templates/html_report.html
    css: assets/css/html_report.css
    self_contained: true
vignette: >
  %\VignetteIndexEntry{t101XX Report}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
bibliography:
  - assets/bib/packages.bib
  - assets/bib/bibliography.bib

---

```{r init, include = FALSE}
#### Load packages and add citation information to packages.bib ----

library(repmis)
LoadandCite(pkgs = c("tidyverse", "lubridate", "ProjectTemplate", "repmis", "biometrics", "knitr", "kableExtra", "broom", "GGally", "captioner", "jtools"),
            file = "assets/bib/packages.bib")
recoder("assets/bib/packages.bib")

#### ProjectTemplate project initiation ----

# see http://projecttemplate.net/configuring.html for configuration
# (configuration also made via config/global.dcf)

# Uncomment if ProjectTemplate package is being used

# wd <- getwd()
# setwd("../")
# load.project(munging = FALSE, data_loading = TRUE)
# setwd(wd)

#### Load template hooks ----

source("assets/R/hooks.R")

#### Load helper functions ----

# source("../R/99-helper.R")

mod_to_tab <- function(x, effects = NULL, tails = 0.975) {
  x %>% 
    tidy(effects = effects) %>% 
    mutate(ci.lo = estimate - std.error * qnorm(tails),
           ci.hi = estimate + std.error * qnorm(tails))
}

round_df <- function(df, digits) {
  mutate_at(df,
            names(df)[vapply(df, is.numeric, FUN.VALUE = logical(1), USE.NAMES = F)],
            .funs = list(~sprintf(paste0("%0.", digits, "f"), .)))
}

library(data.table) # maybe just add as a data object to package
excel_ref <- bind_rows(
  tibble(letters = LETTERS),
  expand.grid(LETTERS, LETTERS, stringsAsFactors = F) %>%
    as_tibble() %>%
    mutate(letters = paste0(Var2, Var1)) %>%
    select(letters),
  expand.grid(LETTERS, LETTERS, LETTERS, stringsAsFactors = F) %>%
    as_tibble() %>%
    mutate(letters = paste0(Var3, Var2, Var1)) %>%
    select(letters)
) %>%
  mutate(numbers = 1:nrow(.)) %>%
  as.data.table()
setkey(excel_ref, numbers)

#### Load data ----

# load("../cache/dat.RData")

#### Captions ("captioner" package) ----

figures <- captioner(prefix = "Figure")
tables <- captioner(prefix = "Table")

tables(name = "tab1", caption = "Caption")
figures(name = "fig1", caption = "Caption.")
figures(name = "fig2", caption = "Example of 'jtools::plot_summs()'.")

# Cite in text with (replacing tab1 with the relevant table/figure name:
#   Full caption: `r tables("tab1")`
#   In-text reference (e.g. Table 1): `r tables("tab1", display = "cite")`
#   Caption number only (e.g. 1): `r tables("tab1", display = "num")`

#### Models ----

# Pre-run models here (if needed)

m1 <- lm(Sepal.Length ~ Sepal.Width, data = filter(iris, Species == "setosa"))
m2 <- lm(Sepal.Length ~ Sepal.Width, data = filter(iris, Species == "versicolor"))
m3 <- lm(Sepal.Length ~ Sepal.Width, data = filter(iris, Species == "virginica"))

models <- bind_rows(
  mod_to_tab(m1) %>% mutate(Species = "setosa"),
  mod_to_tab(m2) %>% mutate(Species = "versicolor"),
  mod_to_tab(m3) %>% mutate(Species = "virginica")
)

#### Data wrangling ----

# All data wrangling should be done in the munge directory, but any further data
# manipulation can be done here.

```

# Overview

XXX from the XXX Research Team is looking to engage in consultation with the Telethon Kids Institute's Biometrics team to undertake statistical analysis to determine ***brief project summary***.

***Study overview to put the analysis in context.***

## Research Questions

1.  Research Question 1
2.  Research Question 2

# Summary of Findings

<!-- Brief parragraph(s) that could be copy/pasted by the researcher into a manuscript, more detailed analysis is provided in the "commentary" section below -->

# Tables

**`r tables("tab1")`**

```{r table_1, table = T, results = "hide", eval = F}
head(iris)

```

# Figures

<!-- A list of figures prepared as a part of the analysis. -->

```{r figure_1, out.extra = "figure", echo = F, warning = F, message = F}
ggplot(iris, aes(Petal.Width, Petal.Length, color = Species)) +
  labs(title = "Iris Dataset", x = "Petal Width", y = "Petal Length") +
  geom_point(size = 4) +
  scale_color_telethonkids(discrete = T, palette = "light") + # scale_fill_telethonkids(discrete = T, palette = "light")
  theme_classic()

```

**`r figures("fig1")`**

```{r q2_estimates_ci_fine, out.extra = "figure", echo = F, warning = F, message = F}
# TKI light palette (hex): c("#FED141", "#ED8B00", "#E0457B", "#C800A1", "#7566A0", "#6CACE4", "#00B2A9", "#78BE20", "#DBE442")
# TKI dark palette (hex): c("#F1B434", "#CB6015", "#B52555", "#A12D86", "#4C4184", "#426DA9", "#008578", "#658D1B", "#BFB800")
# TKI typography palette (hex): c("#B1B3B3", "#97999B", "#75787B", "#53565A")
plot_summs(m1, m2, m3,
                   scale = TRUE,
                   model.names = c("Setosa", "Versicolor", "Virginica"),
                   colors = c("#CB6015", "#A12D86", "#426DA9"),
                   legend.title = "Outcome") +
  labs(title = "Fine Motor Function", subtitle = "Linear Regression Estimates for Motor Delay Persistence") +
  theme(plot.title = element_text(hjust = 0, color = "black"),
        plot.subtitle = element_text(hjust = 0, color = "black"),
        legend.title = element_text(color = "black"),
        legend.text = element_text(color = "black"),
        axis.title = element_text(color = "black"),
        axis.text = element_text(color = "black"))


```

**`r figures("fig2")`**

# Models

<!-- A list of models prepared during the analysis. -->

```{r model_1, table = T, results = "hide", eval = F}
models %>%
  filter(Species == "setosa") %>%
  select(term, estimate, std.error, statistic, ci.lo, ci.hi) %>%
  round_df(2)

```

# Commentary

<!-- Detailed commentary on analysis findings. -->

Reference [@R-biometrics].

# End Matter

## Reproducible Research Information

This document was prepared using the software [R](https://www.r-project.org/), via the [RStudio](https://www.rstudio.com/) IDE, and was written in [RMarkdown](https://rmarkdown.rstudio.com/).

```{r echo = T}
sessionInfo()

```

# References
