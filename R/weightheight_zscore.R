#' weightheight_zscore
#'
#' Calculate the weight-for-length percentile for children aged 0--2 or 2--5.
#' 
#' Function created from the standard weight-for-length tables released by the WHO (https://www.who.int/tools/child-growth-standards/standards/weight-for-length-height).
#' The calculation of the Z-score is done using the methodology of http://www.ncbi.nlm.nih.gov/pubmed/32012066. 
#' 
#' Limitations exist on the height of the child for the respective age classifications. Children aged 0--2 take the admissible height values between 45cm and 110cm (boys and girls). Children aged 2--5 take the admissible height values between 65cm and 120cm (boys and girls).
#' 
#' The function rounds the height value to the nearest 0.5cm, to save interpolation.
#' 
#'
#' @param age the age of the child (days)
#' @param sex the sex of the child ("M" = male, "F" = female)
#' @param length the length of the child (cm)
#' @param weight the weight of the child (kg)
#' @param percentile (default FALSE) return the raw Z-score for the given weight and length
#'
#' @return object of class double
#'
#' @import tidyverse
#' 
#' @examples weightheight_zscore(376, "M", 50, 8, percentile = FALSE)
#'
#' @export
#'

weightheight_zscore <- function(age, sex, length, weight, percentile = FALSE){
  
  # Import standard tables
  
  ### Data downloaded from https://www.who.int/tools/child-growth-standards/standards/weight-for-length-height 
  
  ### Note this is strictly for age 0--2 years
  boys_standard <- structure(list(
    Length = c(45, 45.5, 46, 46.5, 47, 47.5, 48, 48.5, 
               49, 49.5, 50, 50.5, 51, 51.5, 52, 52.5, 53, 53.5, 54, 54.5, 55, 
               55.5, 56, 56.5, 57, 57.5, 58, 58.5, 59, 59.5, 60, 60.5, 61, 61.5, 
               62, 62.5, 63, 63.5, 64, 64.5, 65, 65.5, 66, 66.5, 67, 67.5, 68, 
               68.5, 69, 69.5, 70, 70.5, 71, 71.5, 72, 72.5, 73, 73.5, 74, 74.5, 
               75, 75.5, 76, 76.5, 77, 77.5, 78, 78.5, 79, 79.5, 80, 80.5, 81, 
               81.5, 82, 82.5, 83, 83.5, 84, 84.5, 85, 85.5, 86, 86.5, 87, 87.5, 
               88, 88.5, 89, 89.5, 90, 90.5, 91, 91.5, 92, 92.5, 93, 93.5, 94, 
               94.5, 95, 95.5, 96, 96.5, 97, 97.5, 98, 98.5, 99, 99.5, 100, 
               100.5, 101, 101.5, 102, 102.5, 103, 103.5, 104, 104.5, 105, 105.5, 
               106, 106.5, 107, 107.5, 108, 108.5, 109, 109.5, 110), 
    L = c(-0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521), 
    M = c(2.441, 2.5244, 2.6077, 
          2.6913, 2.7755, 2.8609, 2.948, 3.0377, 3.1308, 3.2276, 3.3278, 
          3.4311, 3.5376, 3.6477, 3.762, 3.8814, 4.006, 4.1354, 4.2693, 
          4.4066, 4.5467, 4.6892, 4.8338, 4.9796, 5.1259, 5.2721, 5.418, 
          5.5632, 5.7074, 5.8501, 5.9907, 6.1284, 6.2632, 6.3954, 6.5251, 
          6.6527, 6.7786, 6.9028, 7.0255, 7.1467, 7.2666, 7.3854, 7.5034, 
          7.6206, 7.737, 7.8526, 7.9674, 8.0816, 8.1955, 8.3092, 8.4227, 
          8.5358, 8.648, 8.7594, 8.8697, 8.9788, 9.0865, 9.1927, 9.2974, 
          9.401, 9.5032, 9.6041, 9.7033, 9.8007, 9.8963, 9.9902, 10.0827, 
          10.1741, 10.2649, 10.3558, 10.4475, 10.5405, 10.6352, 10.7322, 
          10.8321, 10.935, 11.0415, 11.1516, 11.2651, 11.3817, 11.5007, 
          11.6218, 11.7444, 11.8678, 11.9916, 12.1152, 12.2382, 12.3603, 
          12.4815, 12.6017, 12.7209, 12.8392, 12.9569, 13.0742, 13.191, 
          13.3075, 13.4239, 13.5404, 13.6572, 13.7746, 13.8928, 14.012, 
          14.1325, 14.2544, 14.3782, 14.5038, 14.6316, 14.7614, 14.8934, 
          15.0275, 15.1637, 15.3018, 15.4419, 15.5838, 15.7276, 15.8732, 
          16.0206, 16.1697, 16.3204, 16.4728, 16.6268, 16.7826, 16.9401, 
          17.0995, 17.2607, 17.4237, 17.5885, 17.7553, 17.9242, 18.0954, 
          18.2689), 
    S = c(0.09182, 0.09153, 0.09124, 0.09094, 0.09065, 
          0.09036, 0.09007, 0.08977, 0.08948, 0.08919, 0.0889, 0.08861, 
          0.08831, 0.08801, 0.08771, 0.08741, 0.08711, 0.08681, 0.08651, 
          0.08621, 0.08592, 0.08563, 0.08535, 0.08507, 0.08481, 0.08455, 
          0.0843, 0.08406, 0.08383, 0.08362, 0.08342, 0.08324, 0.08308, 
          0.08292, 0.08279, 0.08266, 0.08255, 0.08245, 0.08236, 0.08229, 
          0.08223, 0.08218, 0.08215, 0.08213, 0.08212, 0.08212, 0.08214, 
          0.08216, 0.08219, 0.08224, 0.08229, 0.08235, 0.08241, 0.08248, 
          0.08254, 0.08262, 0.08269, 0.08276, 0.08283, 0.08289, 0.08295, 
          0.08301, 0.08307, 0.08311, 0.08314, 0.08317, 0.08318, 0.08318, 
          0.08316, 0.08313, 0.08308, 0.08301, 0.08293, 0.08284, 0.08273, 
          0.0826, 0.08246, 0.08231, 0.08215, 0.08198, 0.08181, 0.08163, 
          0.08145, 0.08128, 0.08111, 0.08096, 0.08082, 0.08069, 0.08058, 
          0.08048, 0.08041, 0.08034, 0.0803, 0.08026, 0.08025, 0.08025, 
          0.08026, 0.08029, 0.08034, 0.0804, 0.08047, 0.08056, 0.08067, 
          0.08078, 0.08092, 0.08106, 0.08122, 0.08139, 0.08157, 0.08177, 
          0.08198, 0.0822, 0.08243, 0.08267, 0.08292, 0.08317, 0.08343, 
          0.0837, 0.08397, 0.08425, 0.08453, 0.08481, 0.0851, 0.08539, 
          0.08568, 0.08599, 0.08629, 0.0866, 0.08691, 0.08723, 0.08755)), 
    class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA, -131L))
  
  girls_standard <- structure(list(
    Length = c(45, 45.5, 46, 46.5, 47, 47.5, 48, 48.5, 
               49, 49.5, 50, 50.5, 51, 51.5, 52, 52.5, 53, 53.5, 54, 54.5, 55, 
               55.5, 56, 56.5, 57, 57.5, 58, 58.5, 59, 59.5, 60, 60.5, 61, 61.5, 
               62, 62.5, 63, 63.5, 64, 64.5, 65, 65.5, 66, 66.5, 67, 67.5, 68, 
               68.5, 69, 69.5, 70, 70.5, 71, 71.5, 72, 72.5, 73, 73.5, 74, 74.5, 
               75, 75.5, 76, 76.5, 77, 77.5, 78, 78.5, 79, 79.5, 80, 80.5, 81, 
               81.5, 82, 82.5, 83, 83.5, 84, 84.5, 85, 85.5, 86, 86.5, 87, 87.5, 
               88, 88.5, 89, 89.5, 90, 90.5, 91, 91.5, 92, 92.5, 93, 93.5, 94, 
               94.5, 95, 95.5, 96, 96.5, 97, 97.5, 98, 98.5, 99, 99.5, 100, 
               100.5, 101, 101.5, 102, 102.5, 103, 103.5, 104, 104.5, 105, 105.5, 
               106, 106.5, 107, 107.5, 108, 108.5, 109, 109.5, 110), 
    L = c(-0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833), 
    M = c(2.4607, 2.5457, 2.6306, 
          2.7155, 2.8007, 2.8867, 2.9741, 3.0636, 3.156, 3.252, 3.3518, 
          3.4557, 3.5636, 3.6754, 3.7911, 3.9105, 4.0332, 4.1591, 4.2875, 
          4.4179, 4.5498, 4.6827, 4.8162, 4.95, 5.0837, 5.2173, 5.3507, 
          5.4834, 5.6151, 5.7454, 5.8742, 6.0014, 6.127, 6.2511, 6.3738, 
          6.4948, 6.6144, 6.7328, 6.8501, 6.9662, 7.0812, 7.195, 7.3076, 
          7.4189, 7.5288, 7.6375, 7.7448, 7.8509, 7.9559, 8.0599, 8.163, 
          8.2651, 8.3666, 8.4676, 8.5679, 8.6674, 8.7661, 8.8638, 8.9601, 
          9.0552, 9.149, 9.2418, 9.3337, 9.4252, 9.5166, 9.6086, 9.7015, 
          9.7957, 9.8915, 9.9892, 10.0891, 10.1916, 10.2965, 10.4041, 10.514, 
          10.6263, 10.741, 10.8578, 10.9767, 11.0974, 11.2198, 11.3435, 
          11.4684, 11.594, 11.7201, 11.8461, 11.972, 12.0976, 12.2229, 
          12.3477, 12.4723, 12.5965, 12.7205, 12.8443, 12.9681, 13.092, 
          13.2158, 13.3399, 13.4643, 13.5892, 13.7146, 13.8408, 13.9676, 
          14.0953, 14.2239, 14.3537, 14.4848, 14.6174, 14.7519, 14.8882, 
          15.0267, 15.1676, 15.3108, 15.4564, 15.6046, 15.7553, 15.9087, 
          16.0645, 16.2229, 16.3837, 16.547, 16.7129, 16.8814, 17.0527, 
          17.2269, 17.4039, 17.5839, 17.7668, 17.9526, 18.1412, 18.3324), 
    S = c(0.09029, 0.09033, 0.09037, 0.0904, 0.09044, 0.09048, 
          0.09052, 0.09056, 0.0906, 0.09064, 0.09068, 0.09072, 0.09076, 
          0.0908, 0.09085, 0.09089, 0.09093, 0.09098, 0.09102, 0.09106, 
          0.0911, 0.09114, 0.09118, 0.09121, 0.09125, 0.09128, 0.0913, 
          0.09132, 0.09134, 0.09135, 0.09136, 0.09137, 0.09137, 0.09136, 
          0.09135, 0.09133, 0.09131, 0.09129, 0.09126, 0.09123, 0.09119, 
          0.09115, 0.0911, 0.09106, 0.09101, 0.09096, 0.0909, 0.09085, 
          0.09079, 0.09074, 0.09068, 0.09062, 0.09056, 0.0905, 0.09043, 
          0.09037, 0.09031, 0.09025, 0.09018, 0.09012, 0.09005, 0.08999, 
          0.08992, 0.08985, 0.08979, 0.08972, 0.08965, 0.08959, 0.08952, 
          0.08946, 0.0894, 0.08934, 0.08928, 0.08923, 0.08918, 0.08914, 
          0.0891, 0.08906, 0.08903, 0.089, 0.08898, 0.08897, 0.08895, 0.08895, 
          0.08895, 0.08895, 0.08896, 0.08898, 0.089, 0.08903, 0.08906, 
          0.08909, 0.08913, 0.08918, 0.08923, 0.08928, 0.08934, 0.08941, 
          0.08948, 0.08955, 0.08963, 0.08972, 0.08981, 0.0899, 0.09, 0.0901, 
          0.09021, 0.09033, 0.09044, 0.09057, 0.09069, 0.09083, 0.09096, 
          0.0911, 0.09125, 0.09139, 0.09155, 0.0917, 0.09186, 0.09203, 
          0.09219, 0.09236, 0.09254, 0.09271, 0.09289, 0.09307, 0.09326, 
          0.09344, 0.09363, 0.09382, 0.09401)), 
    class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA, -131L))
  
  ### Note this is strictly for age 2--5 years
  boys_2_5 <- structure(list(
    Height = c(65, 65.5, 66, 66.5, 67, 67.5, 68, 68.5, 
               69, 69.5, 70, 70.5, 71, 71.5, 72, 72.5, 73, 73.5, 74, 74.5, 75, 
               75.5, 76, 76.5, 77, 77.5, 78, 78.5, 79, 79.5, 80, 80.5, 81, 81.5, 
               82, 82.5, 83, 83.5, 84, 84.5, 85, 85.5, 86, 86.5, 87, 87.5, 88, 
               88.5, 89, 89.5, 90, 90.5, 91, 91.5, 92, 92.5, 93, 93.5, 94, 94.5, 
               95, 95.5, 96, 96.5, 97, 97.5, 98, 98.5, 99, 99.5, 100, 100.5, 
               101, 101.5, 102, 102.5, 103, 103.5, 104, 104.5, 105, 105.5, 106, 
               106.5, 107, 107.5, 108, 108.5, 109, 109.5, 110, 110.5, 111, 111.5, 
               112, 112.5, 113, 113.5, 114, 114.5, 115, 115.5, 116, 116.5, 117, 
               117.5, 118, 118.5, 119, 119.5, 120), 
    L = c(-0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, -0.3521, 
          -0.3521, -0.3521, -0.3521, -0.3521), 
    M = c(7.4327, 7.5504, 7.6673, 
          7.7834, 7.8986, 8.0132, 8.1272, 8.241, 8.3547, 8.468, 8.5808, 
          8.6927, 8.8036, 8.9135, 9.0221, 9.1292, 9.2347, 9.339, 9.442, 
          9.5438, 9.644, 9.7425, 9.8392, 9.9341, 10.0274, 10.1194, 10.2105, 
          10.3012, 10.3923, 10.4845, 10.5781, 10.6737, 10.7718, 10.8728, 
          10.9772, 11.0851, 11.1966, 11.3114, 11.429, 11.549, 11.6707, 
          11.7937, 11.9173, 12.0411, 12.1645, 12.2871, 12.4089, 12.5298, 
          12.6495, 12.7683, 12.8864, 13.0038, 13.1209, 13.2376, 13.3541, 
          13.4705, 13.587, 13.7041, 13.8217, 13.9403, 14.06, 14.1811, 14.3037, 
          14.4282, 14.5547, 14.6832, 14.814, 14.9468, 15.0818, 15.2187, 
          15.3576, 15.4985, 15.6412, 15.7857, 15.932, 16.0801, 16.2298, 
          16.3812, 16.5342, 16.6889, 16.8454, 17.0036, 17.1637, 17.3256, 
          17.4894, 17.655, 17.8226, 17.9924, 18.1645, 18.339, 18.5158, 
          18.6948, 18.8759, 19.059, 19.2439, 19.4304, 19.6185, 19.8081, 
          19.999, 20.1912, 20.3846, 20.5789, 20.7741, 20.97, 21.1666, 21.3636, 
          21.5611, 21.7588, 21.9568, 22.1549, 22.353), 
    S = c(0.08217, 0.08214, 
          0.08212, 0.08212, 0.08213, 0.08214, 0.08217, 0.08221, 0.08226, 
          0.08231, 0.08237, 0.08243, 0.0825, 0.08257, 0.08264, 0.08272, 
          0.08278, 0.08285, 0.08292, 0.08298, 0.08303, 0.08308, 0.08312, 
          0.08315, 0.08317, 0.08318, 0.08317, 0.08315, 0.08311, 0.08305, 
          0.08298, 0.0829, 0.08279, 0.08268, 0.08255, 0.08241, 0.08225, 
          0.08209, 0.08191, 0.08174, 0.08156, 0.08138, 0.08121, 0.08105, 
          0.0809, 0.08076, 0.08064, 0.08054, 0.08045, 0.08038, 0.08032, 
          0.08028, 0.08025, 0.08024, 0.08025, 0.08027, 0.08031, 0.08036, 
          0.08043, 0.08051, 0.0806, 0.08071, 0.08083, 0.08097, 0.08112, 
          0.08129, 0.08146, 0.08165, 0.08185, 0.08206, 0.08229, 0.08252, 
          0.08277, 0.08302, 0.08328, 0.08354, 0.08381, 0.08408, 0.08436, 
          0.08464, 0.08493, 0.08521, 0.08551, 0.0858, 0.08611, 0.08641, 
          0.08673, 0.08704, 0.08736, 0.08768, 0.088, 0.08832, 0.08864, 
          0.08896, 0.08928, 0.0896, 0.08991, 0.09022, 0.09054, 0.09085, 
          0.09116, 0.09147, 0.09177, 0.09208, 0.09239, 0.0927, 0.093, 0.09331, 
          0.09362, 0.09393, 0.09424)), 
    class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA, -111L))
  
  girls_2_5 <- structure(list(
    Height = c(65, 65.5, 66, 66.5, 67, 67.5, 68, 68.5, 
               69, 69.5, 70, 70.5, 71, 71.5, 72, 72.5, 73, 73.5, 74, 74.5, 75, 
               75.5, 76, 76.5, 77, 77.5, 78, 78.5, 79, 79.5, 80, 80.5, 81, 81.5, 
               82, 82.5, 83, 83.5, 84, 84.5, 85, 85.5, 86, 86.5, 87, 87.5, 88, 
               88.5, 89, 89.5, 90, 90.5, 91, 91.5, 92, 92.5, 93, 93.5, 94, 94.5, 
               95, 95.5, 96, 96.5, 97, 97.5, 98, 98.5, 99, 99.5, 100, 100.5, 
               101, 101.5, 102, 102.5, 103, 103.5, 104, 104.5, 105, 105.5, 106, 
               106.5, 107, 107.5, 108, 108.5, 109, 109.5, 110, 110.5, 111, 111.5, 
               112, 112.5, 113, 113.5, 114, 114.5, 115, 115.5, 116, 116.5, 117, 
               117.5, 118, 118.5, 119, 119.5, 120), 
    L = c(-0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, -0.3833, 
          -0.3833, -0.3833, -0.3833, -0.3833), 
    M = c(7.2402, 7.3523, 7.463, 
          7.5724, 7.6806, 7.7874, 7.893, 7.9976, 8.1012, 8.2039, 8.3058, 
          8.4071, 8.5078, 8.6078, 8.707, 8.8053, 8.9025, 8.9983, 9.0928, 
          9.1862, 9.2786, 9.3703, 9.4617, 9.5533, 9.6456, 9.739, 9.8338, 
          9.9303, 10.0289, 10.1298, 10.2332, 10.3393, 10.4477, 10.5586, 
          10.6719, 10.7874, 10.9051, 11.0248, 11.1462, 11.2691, 11.3934, 
          11.5186, 11.6444, 11.7705, 11.8965, 12.0223, 12.1478, 12.2729, 
          12.3976, 12.522, 12.6461, 12.77, 12.8939, 13.0177, 13.1415, 13.2654, 
          13.3896, 13.5142, 13.6393, 13.765, 13.8914, 14.0186, 14.1466, 
          14.2757, 14.4059, 14.5376, 14.671, 14.8062, 14.9434, 15.0828, 
          15.2246, 15.3687, 15.5154, 15.6646, 15.8164, 15.9707, 16.1276, 
          16.287, 16.4488, 16.6131, 16.78, 16.9496, 17.122, 17.2973, 17.4755, 
          17.6567, 17.8407, 18.0277, 18.2174, 18.4096, 18.6043, 18.8015, 
          19.0009, 19.2024, 19.406, 19.6116, 19.819, 20.028, 20.2385, 20.4502, 
          20.6629, 20.8766, 21.0909, 21.3059, 21.5213, 21.737, 21.9529, 
          22.169, 22.3851, 22.6012, 22.8173), 
    S = c(0.09113, 0.09109, 0.09104, 
          0.09099, 0.09094, 0.09088, 0.09083, 0.09077, 0.09071, 0.09065, 
          0.09059, 0.09053, 0.09047, 0.09041, 0.09035, 0.09028, 0.09022, 
          0.09016, 0.09009, 0.09003, 0.08996, 0.08989, 0.08983, 0.08976, 
          0.08969, 0.08963, 0.08956, 0.0895, 0.08943, 0.08937, 0.08932, 
          0.08926, 0.08921, 0.08916, 0.08912, 0.08908, 0.08905, 0.08902, 
          0.08899, 0.08897, 0.08896, 0.08895, 0.08895, 0.08895, 0.08896, 
          0.08897, 0.08899, 0.08901, 0.08904, 0.08907, 0.08911, 0.08915, 
          0.0892, 0.08925, 0.08931, 0.08937, 0.08944, 0.08951, 0.08959, 
          0.08967, 0.08975, 0.08984, 0.08994, 0.09004, 0.09015, 0.09026, 
          0.09037, 0.09049, 0.09062, 0.09075, 0.09088, 0.09102, 0.09116, 
          0.09131, 0.09146, 0.09161, 0.09177, 0.09193, 0.09209, 0.09226, 
          0.09243, 0.09261, 0.09278, 0.09296, 0.09315, 0.09333, 0.09352, 
          0.09371, 0.0939, 0.09409, 0.09428, 0.09448, 0.09467, 0.09487, 
          0.09507, 0.09527, 0.09546, 0.09566, 0.09586, 0.09606, 0.09626, 
          0.09646, 0.09666, 0.09686, 0.09707, 0.09727, 0.09747, 0.09767, 
          0.09788, 0.09808, 0.09828)), 
    class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA, -111L))
  
  # Helper function to calculate z-score for children aged 0--2
  get_zscore_0_2 <- function(sex, length, weight, percentile = FALSE){
    
    score_formula <- function(weight, L, M, S){
      (((weight/M)^L) - 1)/(L*S) # Cite: http://www.ncbi.nlm.nih.gov/pubmed/32012066
    }
    
    round_nearest <- function(value){
      
      plyr::round_any(value, 0.5) # Round input value to the nearest 0.5. Necessary as tabled height values are given in 0.5cm increments (saves interpolation).
      
    }
    
    adj_len <- round_nearest(length)
    
    if (adj_len < 45 | adj_len > 110){
      print("For age 0--2 the allowable height range per WHO guidelines is between 45 and 110cm for boys and girls.")
    } else {
      if (sex == "M"){
        
        boy <- boys_standard %>%
          filter(Length == adj_len)
        
        z_score <- score_formula(weight, boy$L, boy$M, boy$S)
        
        if (percentile == TRUE){
          perc <- stats::pnorm(z_score) # Return inverse normal distribution value
          return(perc)
          
        } else {
          return(z_score)
        }
        
        
      } else if (sex == "F"){
        girl <- girls_standard %>%
          filter(Length == adj_len)
        
        z_score <- score_formula(weight, girl$L, girl$M, girl$S)
        
        if (percentile == TRUE){
          perc <- stats::pnorm(z_score)
          return(perc)
          
        } else {
          return(z_score)
        }
        
      } else {
        print("Enter valid `sex` variable. 'M' = male, 'F' = female.")
      }
    }
  }
  
  # Helper function to calculate Z-score for children aged 2--5
  get_zscore_2_5 <- function(sex, length, weight, percentile = FALSE){
    
    score_formula <- function(weight, L, M, S){
      (((weight/M)^L) - 1)/(L*S) # Cite: http://www.ncbi.nlm.nih.gov/pubmed/32012066
    }
    
    round_nearest <- function(value){
      
      plyr::round_any(value, 0.5) # Round input value to the nearest 0.5. Necessary as tabled height values are given in 0.5cm increments (saves interpolation).
      
    }
    
    adj_len <- round_nearest(length)
    
    if (adj_len < 65 | adj_len > 120) {
      print("For age 2--5 the allowable height range per WHO guidelines is between 65 and 120cm for boys and girls.")
    } else {
      if (sex == "M"){
        
        boy <- boys_2_5 %>%
          filter(Height == adj_len)
        
        z_score <- score_formula(weight, boy$L, boy$M, boy$S)
        
        if (percentile == TRUE){
          perc <- stats::pnorm(z_score) # Return inverse normal distribution value
          return(perc)
          
        } else {
          return(z_score)
        }
        
        
      } else if (sex == "F"){
        girl <- girls_2_5 %>%
          filter(Height == adj_len)
        
        z_score <- score_formula(weight, girl$L, girl$M, girl$S)
        
        if (percentile == TRUE){
          perc <- stats::pnorm(z_score)
          return(perc)
          
        } else {
          return(z_score)
        }
        
      } else {
        print("Enter valid `sex` variable. 'M' = male, 'F' = female.")
      }
    }
  }
  
  # Logic to initialise correct helper function based on age of child (days)
  
  if (age > 365*2 & age <= 365*5){
    score <- get_zscore_2_5(sex, length, weight, percentile = percentile)
    return(score)
    
  } else if (age <= 365*2){
    score <- get_zscore_0_2(sex, length, weight, percentile = percentile)
    return(score)
  }
}